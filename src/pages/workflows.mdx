# Development cycle

## Create a new extension

To run the interactive initialization wizard, use the following command:

```sh
pnpm dlx plasmo init
# OR npm v7
npm x plasmo init
```

To skip the naming prompt, supply a name as a positional argument:

```sh
pnpm dlx plasmo init "My Awesome Extension"
# OR npm v7
npm x plasmo init "My Awesome Extension"
```

## Run the development server

Once you've set up your project, you can start developing your extension by navigating to your project directory and running:

```sh
pnpm dev
# OR
npm run dev
# OR
plasmo dev
```

This will create a dev bundle for your extension and a hot-reloading development server, automatically updating your extension bundle on file changes and reloading your browser on content-script changes.

## Create a production bundle

To create a production bundle for distribution, run:

```sh
pnpm build
# OR
npm run build
# OR
plasmo build
```

You can optionally supply a `--zip` flag to the build command to create a zip bundle ready to be uploaded to the web stores:

```sh
pnpm build -- --zip
# OR
npm run build -- --zip
# OR
plasmo build --zip
```

> **NOTE:** Since Plasmo's default Typescript configuration treats all source files as modules, if you don't have any imports or exports in your code, you'll have to add an `export {}` line at the start of your file. (You will see this warning when creating your first content script!)

## Adding a Popup Page

Create a `popup.tsx` file or a `popup/index.tsx` file that exports a default React component. With that, your popup is ready to be used ðŸš€! See [with-popup](https://github.com/PlasmoHQ/examples/tree/main/with-popup) for an example.

## Adding Content Scripts

Create a `content.ts` file that exports an empty object (or import some library), and hack away! See [with-content-script](https://github.com/PlasmoHQ/examples/tree/main/with-content-script) for an example.

Create a `contents` directory for multiple content scripts and add your content scripts there. See [with-many-content-scripts](https://github.com/PlasmoHQ/examples/tree/main/with-many-content-scripts) for an example.

To provide a custom content script configuration (such as matching a custom domain per script, all_frames, etc.), export a config object from your content script like so:

```ts
import type { PlasmoContentScript } from "plasmo"

export const config: PlasmoContentScript = {
  matches: ["<all_urls>"],
  all_frames: true
}
```

Working with this configuration object is a breeze thanks to the exported `PlasmoContentScript` type ðŸ¥³.

## Adding a Background script

Create a `background.ts` file in the root directory, and start hacking ðŸ’ª. See [with-background](https://github.com/PlasmoHQ/examples/tree/main/with-background) for an example.

## Adding Options UI

Create either an `options.tsx` or `options/index.tsx` file to render the options_ui ðŸ‘Œ. See [with-options](https://github.com/PlasmoHQ/examples/tree/main/with-options-ui) for an example.

## Adding Environment Variables

The Plasmo framework utilizes a similar .env file cascading/overriding strategy as Next.js, using the [`dotenv` package](https://www.npmjs.com/package/dotenv). To add public environment variables accessible to the extension, create a `.env.local` file like so:

```
PLASMO_PUBLIC_SHIP_NAME=ncc-1701
PLASMO_PUBLIC_SHIELD_FREQUENCY=42

PRIVATE_KEY=xxx
```

Only environment variables prefixed with `PLASMO_PUBLIC_` will be exposed in the built version of your extension. You can then use them in any of your extension source files like so:

```tsx
// For TSX (popups, options):
const FrontHull = () => <h1>{process.env.PLASMO_PUBLIC_SHIP_NAME}</h1>

// For TS (content scripts or background-scripts):
const shield = new Shield(process.env.PLASMO_PUBLIC_SHIELD_FREQUENCY)
```

To override a variable in the production build with `plasmo build`, supply a `.env.production` file, re-declaring just the variable you need to override.

You might also enjoy Typescript IntelliSense with your environment variables ðŸ¤“. To do so, create an `index.d.ts` file with a declaration like so:

```ts
declare namespace NodeJS {
  interface ProcessEnv {
    PLASMO_PUBLIC_SHIP_NAME?: string
    PLASMO_PUBLIC_SHIELD_FREQUENCY?: number
  }
}
```

See [with-env-files](https://github.com/PlasmoHQ/examples/tree/main/with-env-files) for more details about using .env variables.

## Submit Your Extension

The Plasmo Framework ships with a convenient GitHub action called [Browser Platform Publish](http://bpp.browser.market/) or BPP. This action will automatically publish your extension to all supported browser extension markets. By default, it runs on a manual trigger, but changing its config can make it run on every push.

To start publishing your Plasmo extension, set up a `keys.json` file with the schema:

```json
{
  "$schema": "https://raw.githubusercontent.com/PlasmoHQ/bpp/v2/keys.schema.json"
}
```

This schema is most helpful if your editor supports [`JSON schema`](https://json-schema.org/). Make sure only to declare valid submission credentials. Otherwise, the action will fail.

> NOTE: Git ignores this file ignored thanks to our friendly neighborhood `.gitignore`

Please see this [token guide](https://github.com/PlasmoHQ/bms/blob/main/tokens.md) to learn more about the tokens required to submit. The final key might look like this:

```json
{
  "$schema": "https://raw.githubusercontent.com/plasmo-corp/bpp/v2/keys.schema.json",
  "chrome": {
    "clientId": "123",
    "refreshToken": "789",
    "extId": "abcd"
  },
  "edge": {
    "clientId": "aaaaaaa-aaaa-bbbb-cccc-dddddddddddd",
    "clientSecret": "abcdefg",
    "productId": "aaaaaaa-aaaa-bbbb-cccc-dddddddddddd",
    "accessTokenUrl": "https://login.microsoftonline.com/aaaaaaa-aaaa-bbbb-cccc-dddddddddddd/oauth2/v2.0/token"
  }
}
```

Copy this key, and add it as a [repository secret on GitHub](https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository) called `SUBMIT_KEYS`

Then, go on GitHub and trigger the action manually when you need to submit a new extension version!
